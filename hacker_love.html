<!DOCTYPE html>
<html>
<head>
<title>เข้ารหัสลับแห่งหัวใจ</title>
<style>
  /* --- CSS หลัก (เหมือนเดิม) --- */
  body {
    background-color: #000;
    color: #0F0;
    font-family: 'Share Tech Mono', monospace;
    margin: 0;
    display: flex;
    justify-content: center;
    align-items: flex-start; 
    min-height: 150vh; 
    padding-top: 5vh; 
    padding-bottom: 50vh; 
    flex-direction: column;
    align-items: center;
  }

  .terminal {
    background-color: rgba(0, 0, 0, 0.8);
    border: 1px solid #0F0;
    box-shadow: 0 0 15px #0F0;
    padding: 30px;
    border-radius: 8px;
    max-width: 600px;
    width: 90%;
    z-index: 10;
    text-align: left;
    white-space: pre-wrap;
    margin-bottom: 50px; 
  }
  
  /* --- Glitch Effect (และอื่นๆ เหมือนเดิม) --- */
  .glitch { position: relative; display: inline-block; color: #F33; }
  .glitch::before, .glitch::after { content: attr(data-text); position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; clip: rect(0, 900px, 0, 0); }
  .glitch::before { left: 2px; text-shadow: -1px 0 rgba(0, 255, 255, 0.7); animation: glitch-anim-1 2s infinite linear alternate-reverse; }
  .glitch::after { left: -2px; text-shadow: 1px 0 rgba(255, 255, 0, 0.7); animation: glitch-anim-2 3s infinite linear alternate-reverse; }

  @keyframes glitch-anim-1 { 0% { clip: rect(42px, 9999px, 44px, 0); } 10% { clip: rect(10px, 9999px, 20px, 0); } 20% { clip: rect(80px, 9999px, 20px, 0); } 30% { clip: rect(50px, 9999px, 70px, 0); } 40% { clip: rect(10px, 9999px, 90px, 0); } 50% { clip: rect(30px, 9999px, 40px, 0); } 60% { clip: rect(60px, 9999px, 80px, 0); } 70% { clip: rect(20px, 9999px, 40px, 0); } 80% { clip: rect(80px, 9999px, 90px, 0); } 90% { clip: rect(30px, 9999px, 40px, 0); } 100% { clip: rect(70px, 9999px, 90px, 0); } }
  @keyframes glitch-anim-2 { 0% { clip: rect(10px, 9999px, 90px, 0); } 15% { clip: rect(50px, 9999px, 70px, 0); } 30% { clip: rect(20px, 9999px, 40px, 0); } 45% { clip: rect(80px, 9999px, 90px, 0); } 60% { clip: rect(30px, 9999px, 40px, 0); } 75% { clip: rect(60px, 9999px, 80px, 0); } 90% { clip: rect(42px, 9999px, 44px, 0); } 100% { clip: rect(10px, 9999px, 20px, 0); } }
  
  .typing-cursor { display: inline-block; width: 8px; height: 1.2em; background-color: #0F0; margin-left: 2px; vertical-align: middle; animation: blink 0.7s step-end infinite; }
  @keyframes blink { from, to { background-color: transparent; } 50% { background-color: #0F0; } }
  
  .terminal h1 { color: #39F; text-shadow: 0 0 5px #39F; margin-bottom: 20px; font-size: 1.8em; }
  .terminal p { margin-bottom: 15px; line-height: 1.5; }
  .terminal button { background-color: #0A0; color: #000; border: none; padding: 10px 20px; border-radius: 5px; font-family: 'Share Tech Mono', monospace; font-size: 1em; cursor: pointer; transition: background-color 0.3s, box-shadow 0.3s; margin-top: 20px; display: block; width: 100%; text-align: center; }
  .terminal button:hover { background-color: #0F0; box-shadow: 0 0 8px #0F0; }
  #decryptedMessage { margin-top: 20px; color: #F33; text-shadow: 0 0 5px #F33; }
  #statusButtons { margin-top: 20px; text-align: center; display: none; }
  #statusButtons .status-btn { background-color: #39F; color: #000; border: none; padding: 10px 15px; border-radius: 5px; font-family: 'Share Tech Mono', monospace; font-size: 0.9em; cursor: pointer; transition: background-color 0.3s, box-shadow 0.3s; margin: 5px; display: inline-block; }
  #statusButtons .status-btn:hover { background-color: #6CF; box-shadow: 0 0 8px #6CF; }
  #statusButtons .reject-btn { background-color: #F33; }
  #statusButtons .reject-btn:hover { background-color: #F66; box-shadow: 0 0 8px #F66; }
  #finalResponse { margin-top: 20px; display: none; }
  #finalResponse p { color: #0F0; font-size: 1.2em; padding: 15px; border: 1px solid #0F0; border-radius: 5px; background-color: rgba(0, 50, 0, 0.5); animation: revealText 1s forwards; }
  @keyframes revealText { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
  #matrixCanvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; }
</style>

<link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>
</head>
<body>

<canvas id="matrixCanvas"></canvas>

<div class="terminal">
  <h1><span style="color: #F33;">&lt;</span> สถานะ: ตรวจพบข้อมูลลับ <span style="color: #F33;">&gt;</span></h1>
  <p>
    กำลังดำเนินการวิเคราะห์ข้อมูล<br>
    โปรดระบุคำสั่งเพื่อถอดรหัส...<br>
    <span style="color: #FFD700;">&gt; decrypt --heart-data --target=พลอย</span>
  </p>

  <button id="mainButton" onclick="revealLoveMessage()">
    [ENTER] ยืนยันคำสั่ง
  </button>

  <div id="decryptedMessage">
    <p>
      <span style="color: #0F0;">&gt; การถอดรหัสสำเร็จ:</span><br>
      <span style="color: #FFD700;">&gt; แหล่งที่มา: พีม</span><br>
      <span style="color: #FFD700;">&gt; เป้าหมาย: พลอย</span><br>
      <br>
      <span id="glitchText" class="glitch" data-text="Message:">
        Message:
      </span>
      
      <span id="typingArea" style="color: #F33; font-size: 1.3em;">
        <span class="typing-cursor"></span>
      </span>
    </p>
  </div>
  
  <div id="statusButtons">
    <p style="color: #FFD700; margin-top: 10px;">
        &gt; ระบบกำลังรอการตอบกลับ: เลือกสถานะที่ต้องการกำหนด
    </p>
    <button class="status-btn" onclick="selectStatus('คุย')">
        1. เป็นคนคุย
    </button>
    <button class="status-btn" onclick="selectStatus('แฟน')">
        2. เป็นแฟน
    </button>
    <button class="status-btn reject-btn" onclick="selectStatus('ปฏิเสธ')">
        3. ไม่เป็นอะไรเลย
    </button>
  </div>
  
  <div id="finalResponse">
    </div>
</div>

<audio id="clickSound" src="https://www.soundjay.com/buttons/beep-07.mp3" preload="auto"></audio>

<script>
  // 2. Firebase Configuration (ใช้ค่าที่คุณให้มา)
  const firebaseConfig = {
    apiKey: "AIzaSyDRlB6q1NJeSnO4JsLQcUHr28XGKo573sk",
    authDomain: "peem-dc962.firebaseapp.com",
    databaseURL: "https://peem-dc962-default-rtdb.firebaseio.com",
    projectId: "peem-dc962",
    storageBucket: "peem-dc962.firebasestorage.app",
    messagingSenderId: "1021248731842",
    appId: "1:1021248731842:web:7b5fdf322f9ca1af78595b",
    measurementId: "G-06R4YSWH3H"
  };

  // Initialize Firebase (ไม่ต้องใช้ getAnalytics ใน HTML ธรรมดา)
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database(); // อ้างอิงถึง Database

  // --- การกำหนดค่าหลัก ---
  const TYPING_TEXT = `ถึง พลอย...
        ข้อมูลหัวใจของ พีม ยืนยันว่า...
        ฉันตกหลุมรักคุณเข้าให้แล้ว
        นี่ไม่ใช่ความผิดพลาดของระบบแน่นอน`;

  let i = 0;
  let typingInterval;
  const typingArea = document.getElementById('typingArea');
  const cursor = typingArea.querySelector('.typing-cursor');
  const mainButton = document.getElementById('mainButton');
  const messageDiv = document.getElementById('decryptedMessage');
  const statusButtonsDiv = document.getElementById('statusButtons');
  const finalResponseDiv = document.getElementById('finalResponse');
  const glitchText = document.getElementById('glitchText');
  const clickSound = document.getElementById('clickSound');

  function playClick() {
    clickSound.currentTime = 0;
    clickSound.play().catch(e => console.error("Sound play failed:", e));
  }
  
  function typeWriter() {
    if (i < TYPING_TEXT.length) {
      typingArea.insertBefore(document.createTextNode(TYPING_TEXT.charAt(i)), cursor);
      i++;
      if (i % 3 === 0) { playClick(); }
      typingInterval = setTimeout(typeWriter, 50);
    } else {
      clearInterval(typingInterval);
      cursor.style.display = 'none';
      statusButtonsDiv.style.display = 'block';
      statusButtonsDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
  }

  function revealLoveMessage() {
    playClick();
    if (mainButton.textContent.includes('ยืนยันคำสั่ง')) {
      messageDiv.style.display = 'block';
      finalResponseDiv.style.display = 'none';
      statusButtonsDiv.style.display = 'none';
      
      i = 0;
      typingArea.textContent = '';
      typingArea.appendChild(cursor);
      cursor.style.display = 'inline-block';
      typeWriter();
      
      mainButton.textContent = '[ABORT] ยกเลิกกระบวนการ';
      mainButton.style.backgroundColor = '#600';
      mainButton.style.boxShadow = '0 0 8px #F33';

      glitchText.setAttribute('data-text', 'Message:');
      glitchText.style.animationPlayState = 'running';
      
    } else {
      clearTimeout(typingInterval);
      messageDiv.style.display = 'none';
      statusButtonsDiv.style.display = 'none';
      finalResponseDiv.style.display = 'none';
      glitchText.style.animationPlayState = 'paused';
      
      mainButton.textContent = '[ENTER] ยืนยันคำสั่ง';
      mainButton.style.backgroundColor = '#0A0';
      mainButton.style.boxShadow = '0 0 8px #0F0';
    }
  }

  // *** ฟังก์ชันสำคัญ: บันทึกคำตอบไปยัง Firebase ***
  function selectStatus(status) {
    playClick();
    
    // 3. บันทึกคำตอบใน Firebase
    db.ref('PloyStatus').set({
        status: status,
        timestamp: new Date().toLocaleString('th-TH'),
        sender: 'Phim'
    }).then(() => {
        console.log("Status successfully sent to Firebase!");
    }).catch((error) => {
        console.error("Error sending status:", error);
    });

    statusButtonsDiv.style.display = 'none';
    
    let responseText = "";
    
    if (status === 'คุย') {
        responseText = "<span style='color: #FFD700;'>&gt; สถานะใหม่: [คนคุย]</span><br>ยินดีที่ได้รับคำตอบ! พีมและพลอยมาเริ่มกระบวนการ 'ทำความรู้จัก' (Initiating Relationship Protocol) กันเลยนะ! **(ข้อมูลถูกส่งไปยัง Admin Server แล้ว)**";
    } else if (status === 'แฟน') {
        responseText = "<span style='color: #F33;'>&gt; สถานะใหม่: [แฟน]</span><br>การเชื่อมต่อสำเร็จ! พีมและพลอยเป็นคู่กันแล้วนะ! หัวใจเต้นแรงเกินขีดจำกัด! **(ข้อมูลถูกส่งไปยัง Admin Server แล้ว)**";
    } else if (status === 'ปฏิเสธ') {
        responseText = "<span style='color: #FF0000;'>&gt; สถานะ: [ปฏิเสธ]</span><br>รับทราบ. การเชื่อมต่อถูกยกเลิก. ถึง พีม จะรู้สึกผิดหวัง (System Error) แต่ฉันก็เคารพการตัดสินใจของ พลอย นะ. **(ข้อมูลถูกส่งไปยัง Admin Server แล้ว)**";
    }

    finalResponseDiv.innerHTML = `<p>${responseText}</p>`;
    finalResponseDiv.style.display = 'block';
    finalResponseDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
  }

  // --- Matrix Effect (เหมือนเดิม) ---
  const canvas = document.getElementById('matrixCanvas');
  const ctx = canvas.getContext('2d');
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  const characters = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ!@#$%^&*()_+-=[]{}|;:",./<>?`~';
  const fontSize = 16;
  const columns = canvas.width / fontSize;
  const drops = Array.from({ length: columns }, () => 1);
  function drawMatrix() {
    ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = '#0F0';
    ctx.font = `${fontSize}px Share Tech Mono`;
    for (let i = 0; i < drops.length; i++) {
      const text = characters.charAt(Math.floor(Math.random() * characters.length));
      ctx.fillText(text, i * fontSize, drops[i] * fontSize);
      if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) {
        drops[i] = 0;
      }
      drops[i]++;
    }
    requestAnimationFrame(drawMatrix);
  }
  drawMatrix();
  window.addEventListener('resize', () => {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    drops.length = Math.floor(canvas.width / fontSize);
    for (let i = 0; i < drops.length; i++) { drops[i] = 1; }
  });
  
  document.addEventListener('DOMContentLoaded', () => {
      messageDiv.style.display = 'none';
      statusButtonsDiv.style.display = 'none';
      glitchText.style.animationPlayState = 'paused';
  });
</script>

</body>
</html>